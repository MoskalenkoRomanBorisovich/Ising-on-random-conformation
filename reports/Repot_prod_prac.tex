\documentclass[a4paper,12pt]{article}

%%% Работа с русским языком
\usepackage{cmap}					% поиск в PDF
\usepackage{mathtext} 				% русские буквы в фомулах
\usepackage[T2A]{fontenc}			% кодировка
\usepackage[utf8]{inputenc}			% кодировка исходного текста
\usepackage[english,russian]{babel}	% локализация и переносы

%%% Дополнительная работа с математикой
\usepackage{amsfonts,amssymb,amsthm,mathtools} % AMS
\usepackage{amsmath}
\usepackage{icomma} % "Умная" запятая: $0,2$ --- число, $0, 2$ --- перечисление

%% Номера формул
%\mathtoolsset{showonlyrefs=true} % Показывать номера только у тех формул, на которые есть \eqref{} в тексте.

\usepackage{hyperref}
\hypersetup{
    colorlinks=false,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
}

\usepackage{float}

% matplotlib plots
\usepackage{pgf}
\usepackage[utf8]{inputenc}\DeclareUnicodeCharacter{2212}{-}

% insert pdf pages
\usepackage{pdfpages}

\usepackage[section]{placeins} % stop figures from floating

%% Шрифты
\usepackage{euscript}	 % Шрифт Евклид
\usepackage{mathrsfs} % Красивый матшрифт

%%% Работа с картинками
\usepackage{graphicx}  % Для вставки рисунков
\graphicspath{{images/}{images2/}}  % папки с картинками
\setlength\fboxsep{3pt} % Отступ рамки \fbox{} от рисунка
\setlength\fboxrule{1pt} % Толщина линий рамки \fbox{}
\usepackage{wrapfig} % Обтекание рисунков и таблиц текстом
\usepackage{caption}
\usepackage{subcaption}
\captionsetup{labelsep=period} %. вместо : в рис

\title{Отчёт по проекту Решеточные модели макромолекул}
%\title{Информация о замерах}
\author{Москаленко Р. Б.}
\date{24.05.2021}

\begin{document}

\includepdf[pages=-]{report_header.pdf}


\input{Sections/General}

\subsection{Цели}
Целью данной работы является исследовать магнитную восприимчивость конформаций, полученных при низких температурах и используя её попробовать определить точку магнитного перехода в конформациях. Так же рассмотреть магнитные свойства конформаций при высоких температурах, и проверить предположение об отсутствии магнитного перехода в них.

\section{Предыдущие результаты}

Ранее при работе на данном проекте был написан программный комплекс для генерации конформаций и расчёта свойств модели Изинга на конформациях. В предыдущих исследованиях мы пытались определить точку магнитного перехода в глобулярных конформациях, для определения точки перехода использовался кумулянт Биндера. Однако оказалось, что только у $60\%$ полученных конформаций намагниченность превышает 0.9 при $\beta = 1$, и большая часть оставшихся конформаций почти не намагничивалась. Из-за большой вариации в значениях намагниченности между конформациями, погрешность при вычислении кумулянта была слишком большой, чтобы точно определить точку перехода. Так же мы пробовали выделить среди полученных конформаций только глобулярные основываясь на их геометрических свойствах, таких как радиус инерции и размеры кластеров вершин (связанных множеств вершин, не имеющих одномерных сегментов внутри себя). Данный подход позволил уменьшить погрешность, но этого оказалось недостаточно для определения точки перехода.

\section{Магнитная восприимчивость} 
Магнитная восприимчивость это отношение намагниченности конформации к напряжённость внешнего поля. Ожидается, что в намагничивающихся конформациях в точке перехода должен наблюдаться пик магнитной восприимчивости, в то время как в не намагничивающихся магнитная восприимчивость не будет иметь пиков.

Получим формулу для магнитной восприимчивости конформации.

По определению
\[
\frac{\partial\langle |M|\rangle}{\partial h}
\]
Подставим формулу намагниченности и продифференцируем.
\[
\frac{\sum_\sigma {|M| e^{-\beta H} \left( -\beta \frac{\partial H}{\partial h}\right)} \cdot Z - \sum_\sigma {|M| e^{-\beta H}} \cdot \sum_\sigma {e^{-\beta H} \left( -\beta \frac{\partial H}{\partial h}\right)}}{Z^2}
\] 

Заметим, что 

\[
\frac{\partial H}{\partial h} = -\sum_i\sigma_i = -|M|
\]
Тогда
\[
\frac{\partial\langle |M|\rangle}{\partial h} = \frac{\sum_\sigma {Z\beta M^2 e^{-\beta H}} - \sum_\sigma {|M| e^{-\beta H}}\cdot \sum_\sigma {\beta |M| e^{-\beta H}}}{Z^2} = \beta \left(\langle M^2\rangle - \langle |M| \rangle^2 \right)
\]


По данной формуле мы можем вычислить магнитную восприимчивость конформаций, используя значения абсолютной намагниченности и квадрата намагниченности, полученные при при расчёте модели Изинга.

\subsection{Результаты замеров}
Для рассмотрения были взяты 10000 конформаций с длинами 250, 500 и 1000. Замеры были сделаны при 10 значениях $\beta$, линейно распределённых от 0.1 до 1.0. 

Все конформации либо имеют единственный пик магнитной восприимчивости, либо магнитная восприимчивость непрерывно возрастает с увеличением $\beta$.

\begin{figure}[htb]
	\centering	
	\input{"images/ms_peaks_all_far.pgf"}
	\caption{Распределение пиков магнитной восприимчивости по конформациям. Цветами отмечены разные длины конформаций. Число конформаций каждый длины 10000. }
	\label{fig:ms_peaks}
\end{figure}


\begin{figure}[hbt]
	\centering
	\input{images/mag2_no_peaks.pgf}
	\caption{Средняя намагниченность конформаций с пиками магнитной восприимчивости в $\beta = 1$. Цветами отмечены разные длины конформаций.}
	\label{fig:no_peaks_mag2}
\end{figure}


Как видно на Рис.\ref{fig:ms_peaks} при увеличении длины конформаций пики магнитной восприимчивости начинают встречаться либо около $\beta = 0.5$ либо $\beta = 1.0$. Конформации с пиком в $\beta = 1.0$, то есть конформаций, у которых магнитная восприимчивость непрерывно возрастает, являются не намагничивающимися (Рис. \ref{fig:no_peaks_mag2}). Тогда точка перехода должна находиться в окрестности $\beta = 0.5$, что совпадает с предположительным положением точки перехода, полученным при помощи Кумулянта Биндера \cite{binder_cumulant} ранее. 





Для уточнения точки перехода были сделаны замеры в десяти точках на отрезке $[0.4, 0.6]$. Так же рассматривались только конформации, у которых ранее был найден пик при $\beta=0.5$ или $\beta=0.6$. Число рассматриваемых конформаций 6873, 7037, 6739 для длин 250, 500 и 1000 соответственно. Результаты представлены на Рис.\ref{fig:ms_peaks_close}. При увеличении длины конформаций значительно увеличивается количество конформаций с пиками в $\beta = 0.50, \beta = 0.52$, однако так же появляются пики в $\beta = 0.48$ и $ \beta = 0.6$ хотя и сравнительно меньше. Текущих данных ещё недостаточно для точного определения точки перехода.


\begin{figure}[htb]
	\centering
	\input{images/ms_peaks_close.pgf}
	\caption{Распределение пиков магнитной восприимчивости для конформаций c пиком около $\beta = 0.5$. Цветом отмечены длины конформаций.}
	\label{fig:ms_peaks_close}
\end{figure}

\section{Конформации при низких температурах}
До этого мы рассматривали только конформации полученные при низких температурах, где мы хотим определить точку перехода. Другая часть этого исследования заключается в проверке того, что у конформаций, полученных при низкой температуре, магнитный фазовый переход не отсутствует.

Для этого были cгенерированы 4 набора конформаций с длинами 250, 500, 1000, 2000 по 1000 конформаций в каждом наборе. Как и ожидалось средняя намагниченность по конформациям значительно меньше, чем у конформаций при $U = 1$(сравнение на Рис. \ref{fig:U0.1_mean_mag2}). 

\begin{figure}[htb]
	\centering
	\input{"images/U=0.1_mean_mag2_with_U=1.pgf"}
    
    \caption{Средняя намагниченность конформаций при $U=0.1$. Цветами отмечены конформации разной длины, число конформаций каждой длины - 1000. Красный график намагниченности конформаций при $U=1$, длины 1000.}
    \label{fig:U0.1_mean_mag2}
\end{figure}

Среди полученных конформаций так же встречаются намагничивающиеся. Однако если мы посмотрим на намагниченность конформаций при $\beta = 1$ то среди конформаций длины 250 будет только 4 конформации с намагниченностью больше 0.9, среди конформаций длиной 500 их 2, и в наборах с длинами 1000 и 2000 таких конформаций нет. На рис.\ref{fig:fraction_magnetization} видно, что не намагничивающиеся конформации составляют большую часть всех конформаций, и что при увеличении длины конформаций, доля намагничивающихся конформаций уменьшается. Максимальная намагниченность, достигаемая конформациями: 0.950, 0.947, 0.799, 0.788 - для длин 250, 500, 1000, 2000 соответственно.



\begin{figure}[htb]
	\centering
	\input{"images/U=0.1_fraction_of_conformations.pgf"}
	\caption{Доля конформаций, намагниченность которых в точке $\beta = 1$ больше чем заданное значение. Цветами отмечены конформации разной длины, число конформаций каждой длины - 1000.}
	\label{fig:fraction_magnetization}
\end{figure}

При увеличении длины конформаций средняя намагниченность, и максимальная достигаемая намагниченность уменьшаются. Что подтверждает предположение о том, что при $L\to \infty$ конформации не будут намагничиваться.

\section{Технические задачи}
При выполнении основных задач возникали технические проблемы, связанные с новыми объёмами вычислений и количеством конформаций. В этом отделе я опишу встреченные проблемы, и то как я их решал.

В описанных выше задачах для лучшей точности использовалось большое количество конформаций (10000 конформаций одной длины). До этого момента мне не приходилось использовать более проводить вычисления более чем на 1000 конформаций. Система на суперкомпьютерном кластере ВШЭ позволяла мне просто поставить 1000 задач в очередь. С новыми объёмами данных система не позволяла мне поставить в очередь 10000 задач. Чтобы решить данную проблему, я более углублённо разобрался в системе slurm и написал новый скрипт, который последовательно проводит вычисления на нескольких конформациях в одной задаче и запускает эти задачи параллельно на кластере используя job arrray.

Из-за увеличения количества данных, используемых для исследований, мне пришлось написать классы и функции для загрузки и представления этих данных в python. Так как раньше я загружал данные вручную в виде numpy массивов, и это стало создавать много неудобств и ошибки в работе. Так же для избежания ошибок, я написал скрипт, проверяющий полученные наборы данных: длину конформаций, точки замеров, сходимость вычислений модели Изинга.

При вычислении магнитной восприимчивости было необходимо сделать замеры 2 раза на одних и тех же конформациях, но в разных точках. И, используя данные из первого замера отобрать
конформации для дальнейшего изучения во втором замере. Для этого мне пришлось доработать код, производящий вычисления на кластере, чтобы замеры проводились на одинаковых конформациях, и написать код объединяющий полученные данные. 

Так же для написания отчётов я более подробно разобрался в работе с latex, в частности научился экспортировать графики matplotlib в latex используя формат pgf, что позволяет сохранить качество картинок и шрифт.

\section{Заключение}
При рассмотрении магнитной восприимчивости конформаций полученных при низких температурах было обнаружено. Что при увеличении длины конформаций конформаций, конформации можно разделить на две группы: не намагничивающиеся конформации без пиков восприимчивости, намагничивающиеся конформации с пиком около 0.5. Для более точного определения точки перехода необходимо рассмотреть конформации с большей длиной, и увеличить число точек замеров.

Конформации при низких температурах ($U=0.1$) в среднем не намагничиваются, и доля намагничивающихся конформаций уменьшается с увеличением длины конформаций. Что подтверждает предположение об отсутствии магнитного перехода в конформациях с низкими температурами. 

В ходе работы я лучше изучил термодинамику и статистическую физику, приобрёл новые навыки работы с супер компьютером и параллельными вычислениями, получил опыт в обработке и хранении данных.


\begin{thebibliography}{9}
\bibitem{github}
 Ссылка на репозиторий: https://github.com/MoskalenkoRomanBorisovich/Ising-on-random-conformation 
 
\bibitem{ising}
Ernst Ising, Contribution to the Theory of Ferromagnetism, 1925


\bibitem{wolf_algorithm}
 U. Wolff, Collective Monte Carlo Updating for Spin Systems. Physical Review Letters. 62 (4): 361–364, 1989
 
\bibitem{binder_cumulant}
 K. Binder, Finite size scaling analysis of ising model block distribution functions. Zeitschrift für Physik B: Condensed Matter. 43 (2): 119–140, 1981

\end{thebibliography}

\end{document}